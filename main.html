<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Космическая игра</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a2a; color: white; font: 24px Arial; text-align: center; }
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; background: rgba(10, 10, 42, 0.92); }
        #game-screen, #stats-screen { display: none; }
        button { padding: 16px 48px; background: linear-gradient(to bottom, #4a86e8, #2a5298); color: white; border: none; border-radius: 50px; cursor: pointer; margin: 18px; font-size: 22px; font-weight: bold; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4), 0 0 15px rgba(74, 134, 232, 0.6); transition: all 0.3s; }
        button:hover { background: linear-gradient(to bottom, #5a96f8, #3a62a8); transform: translateY(-2px); box-shadow: 0 7px 20px rgba(0, 0, 0, 0.5), 0 0 20px rgba(74, 134, 232, 0.8); }
        button:disabled { background: #5a6a8a; cursor: not-allowed; transform: none; }
        #game { width: 800px; height: 600px; position: relative; background: #000 url('img/space.png') repeat; margin: 20px auto; overflow: hidden; border: 4px solid #4a86e8; border-radius: 12px; box-shadow: 0 0 30px rgba(74, 134, 232, 0.7); }
        .hud { position: absolute; top: 20px; left: 20px; text-align: left; background: rgba(0, 10, 30, 0.85); padding: 15px; border-radius: 10px; border: 2px solid #4a86e8; min-width: 180px; font-size: 20px; z-index: 100; }
        .health-bar { position: absolute; top: 20px; right: 20px; width: 220px; height: 30px; background: #222; border: 3px solid #444; border-radius: 15px; overflow: hidden; z-index: 100; }
        .health-fill { height: 100%; width: 100%; background: linear-gradient(to right, #ff4444, #ffaa00, #44ff44); border-radius: 12px; transition: width 0.3s; }
        .shield-indicator { position: absolute; top: 20px; right: 260px; width: 40px; height: 40px; background: #4a86e8; border-radius: 50%; border: 3px solid white; opacity: 0; transition: opacity 0.3s; z-index: 100; box-shadow: 0 0 15px rgba(74, 134, 232, 0.8); }
        .obj { position: absolute; background-size: contain; background-repeat: no-repeat; background-position: center; }
        .coin, .box { width: 50px; height: 50px; }
        .eb { transform: scaleY(-1); }
        h1 { font-size: 56px; margin-bottom: 35px; color: #4a86e8; text-shadow: 0 0 15px rgba(74, 134, 232, 0.8); letter-spacing: 3px; }
        .stats-item { font-size: 32px; margin: 20px 0; color: #f1c40f; text-shadow: 0 0 10px rgba(241, 196, 15, 0.7); }
        .stats-label { color: #4a86e8; font-size: 26px; margin-left: 10px; }
        input { padding: 16px; font-size: 24px; border: 3px solid #4a86e8; border-radius: 50px; margin: 25px; text-align: center; background: rgba(20, 20, 50, 0.8); color: white; width: 300px; }
        input:focus { outline: none; border-color: #a0c0ff; box-shadow: 0 0 20px rgba(160, 192, 255, 0.6); }
        .instructions { background: rgba(30, 30, 60, 0.85); padding: 15px 30px; border-radius: 50px; margin-top: 25px; font-size: 18px; border: 2px solid #4a86e8; }
    </style>
</head>
<body>
    <div id="start-screen" class="screen">
        <h1>КОСМИЧЕСКАЯ ИГРА</h1>
        <input type="text" id="name" placeholder="Ваше имя" maxlength="15">
        <button id="start-btn" disabled>НАЧАТЬ</button>
        <div class="instructions">Управление: WASD/стрелки | Стрельба: Пробел</div>
    </div>

    <div id="game-screen">
        <div id="game">
            <div class="hud">
                <div>Время: <span id="timer">00:00</span></div>
                <div>Монеты: <span id="coins">0</span></div>
                <div>Патроны: <span id="ammo">30</span></div>
            </div>
            <div class="health-bar"><div class="health-fill" id="health"></div></div>
            <div class="shield-indicator" id="shield"></div>
        </div>
    </div>

    <div id="stats-screen" class="screen">
        <h1>ИГРА ОКОНЧЕНА</h1>
        <div class="stats-item">Время: <span class="stats-label" id="final-time">00:00</span></div>
        <div class="stats-item">Монет: <span class="stats-label" id="final-coins">0</span></div>
        <div class="stats-item">Врагов: <span class="stats-label" id="final-enemies">0</span></div>
        <button id="restart-btn">НОВАЯ ИГРА</button>
        <button id="menu-btn">МЕНЮ</button>
    </div>

    <script>
        // ============ ЗАГРУЗКА КАРТИНОК ============
        
        var images = {};
        var imageNames = ['space', 'rocket', 'asteroid', 'box', 'bullet', 'enemy', 'money'];
        
        for (var i = 0; i < imageNames.length; i++) {
            var name = imageNames[i];
            images[name] = new Image();
            images[name].src = 'img/' + name + '.png';
        }
        
        // ============ ГЛАВНЫЙ ОБЪЕКТ ИГРЫ ============
        
        var game = {
            // Настройки
            gameArea: document.getElementById('game'),
            width: 800,
            height: 600,
            
            // Счетчики
            time: 0,
            coins: 0,
            ammo: 30,
            health: 100,
            
            // Состояние
            running: false,
            hasShield: false,
            keys: {},
            
            // Игрок
            player: {
                x: 0,
                y: 0,
                width: 60,
                height: 80,
                speed: 7,
                img: null
            },
            
            // Массивы объектов
            enemies: [],
            asteroids: [],
            coinItems: [],
            boxes: [],
            playerBullets: [],
            enemyBullets: [],
            
            // Статистика
            stats: {
                time: 0,
                coins: 0,
                enemies: 0
            },
            
            lastEnemyTime: 0,
            lastShotTime: 0,
            
            // ============ ИНИЦИАЛИЗАЦИЯ ============
            init: function() {
                var self = game;
                
                // Начальная позиция игрока
                self.player.x = self.width / 2 - 30;
                self.player.y = self.height - 80;
                self.player.img = images.rocket;
                
                // Обработка ввода имени
                document.getElementById('name').oninput = function(event) {
                    document.getElementById('start-btn').disabled = (event.target.value.trim() === '');
                };
                
                // Кнопки
                document.getElementById('start-btn').onclick = function() {
                    self.start();
                };
                
                document.getElementById('restart-btn').onclick = function() {
                    self.start();
                };
                
                document.getElementById('menu-btn').onclick = function() {
                    document.getElementById('stats-screen').style.display = 'none';
                    document.getElementById('start-screen').style.display = 'flex';
                };
                
                // Клавиши
                document.onkeydown = function(event) {
                    self.keys[event.key.toLowerCase()] = true;
                };
                
                document.onkeyup = function(event) {
                    self.keys[event.key.toLowerCase()] = false;
                };
                
                // Генерация объектов
                setInterval(function() {
                    if (self.running) self.addAsteroid();
                }, 2000);
                
                setInterval(function() {
                    if (self.running) self.addCoin();
                }, 2000);
                
                setInterval(function() {
                    if (self.running) self.addBox();
                }, 10000);
                
                setInterval(function() {
                    if (self.running) self.addEnemy();
                }, 10000);
                
                // Время
                setInterval(function() {
                    if (self.running) {
                        self.time++;
                        self.updateTime();
                    }
                }, 1000);
                
                // Стрельба
                setInterval(function() {
                    if (self.running && self.keys[' '] && self.ammo > 0 && Date.now() - self.lastShotTime > 200) {
                        self.shoot();
                    }
                }, 50);
                
                // Запуск игры
                self.loop();
            },
            
            // ============ НАЧАЛО ИГРЫ ============
            start: function() {
                var self = game;
                
                // Показать игровой экран
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('stats-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                
                // Сбросить всё
                self.time = 0;
                self.coins = 0;
                self.ammo = 30;
                self.health = 100;
                self.running = true;
                self.hasShield = false;
                
                self.player.x = self.width / 2 - 30;
                self.player.y = self.height - 80;
                self.player.img = images.rocket;
                
                self.enemies = [];
                self.asteroids = [];
                self.coinItems = [];
                self.boxes = [];
                self.playerBullets = [];
                self.enemyBullets = [];
                
                self.stats = { time: 0, coins: 0, enemies: 0 };
                self.lastEnemyTime = Date.now();
                self.lastShotTime = 0;
                
                self.updateHealthBar();
                document.getElementById('timer').textContent = '00:00';
                document.getElementById('coins').textContent = '0';
                document.getElementById('ammo').textContent = '30';
                document.getElementById('shield').style.opacity = '0';
            },
            
            // ============ ВРЕМЯ ============
            updateTime: function() {
                var self = game;
                var minutes = Math.floor(self.time / 60);
                var seconds = self.time % 60;
                if (minutes < 10) minutes = '0' + minutes;
                if (seconds < 10) seconds = '0' + seconds;
                document.getElementById('timer').textContent = minutes + ':' + seconds;
            },
            
            // ============ ДОБАВЛЕНИЕ ОБЪЕКТОВ ============
            addAsteroid: function() {
                var self = game;
                self.asteroids.push({
                    x: Math.random() * (self.width - 60),
                    y: -60,
                    width: 60,
                    height: 60,
                    speed: 3 + Math.random() * 2,
                    img: images.asteroid
                });
            },
            
            addCoin: function() {
                var self = game;
                self.coinItems.push({
                    x: Math.random() * (self.width - 50),
                    y: -60,
                    width: 50,
                    height: 50,
                    speed: 2 + Math.random(),
                    img: images.money
                });
            },
            
            addBox: function() {
                var self = game;
                self.boxes.push({
                    x: Math.random() * (self.width - 50),
                    y: -60,
                    width: 50,
                    height: 50,
                    speed: 2 + Math.random(),
                    img: images.box
                });
            },
            
            addEnemy: function() {
                var self = game;
                if (Date.now() - self.lastEnemyTime < 10000) return;
                
                self.enemies.push({
                    x: Math.random() * (self.width - 100),
                    y: 50,
                    width: 100,
                    height: 70,
                    vx: (Math.random() > 0.5 ? 1 : -1) * (2 + Math.random() * 2),
                    health: [10, 20, 30][Math.floor(Math.random() * 3)],
                    lastShot: Date.now(),
                    img: images.enemy
                });
                
                self.lastEnemyTime = Date.now();
            },
            
            // ============ СТРЕЛЬБА ============
            shoot: function() {
                var self = game;
                self.ammo--;
                self.lastShotTime = Date.now();
                document.getElementById('ammo').textContent = self.ammo;
                
                self.playerBullets.push({
                    x: self.player.x + 26,
                    y: self.player.y - 30,
                    width: 12,
                    height: 35,
                    speed: -12,
                    img: images.bullet
                });
            },
            
            // ============ СТОЛКНОВЕНИЯ ============
            checkCollision: function(a, b) {
                return a.x < b.x + b.width - 10 && 
                       a.x + a.width - 10 > b.x && 
                       a.y < b.y + b.height - 10 && 
                       a.y + a.height - 10 > b.y;
            },
            
            // ============ ЩИТ ============
            activateShield: function() {
                var self = game;
                self.hasShield = true;
                self.player.img = images.bullet;
                document.getElementById('shield').style.opacity = '1';
                
                setTimeout(function() {
                    self.hasShield = false;
                    self.player.img = images.rocket;
                    document.getElementById('shield').style.opacity = '0';
                }, 5000);
            },
            
            // ============ ОБНОВЛЕНИЕ ============
            update: function() {
                var self = game;
                if (!self.running) return;
                
                // Управление игроком
                self.player.vx = 0;
                self.player.vy = 0;
                
                if (self.keys['a'] || self.keys['arrowleft'] || self.keys['ф']) self.player.vx = -self.player.speed;
                if (self.keys['d'] || self.keys['arrowright'] || self.keys['в']) self.player.vx = self.player.speed;
                if (self.keys['w'] || self.keys['arrowup'] || self.keys['ц']) self.player.vy = -self.player.speed;
                if (self.keys['s'] || self.keys['arrowdown'] || self.keys['ы']) self.player.vy = self.player.speed;
                
                self.player.x += self.player.vx;
                self.player.y += self.player.vy;
                
                // Границы экрана
                if (self.player.x < 0) self.player.x = 0;
                if (self.player.x > self.width - self.player.width) self.player.x = self.width - self.player.width;
                if (self.player.y < 0) self.player.y = 0;
                if (self.player.y > self.height - self.player.height) self.player.y = self.height - self.player.height;
                
                // Враги
                for (var i = self.enemies.length - 1; i >= 0; i--) {
                    var enemy = self.enemies[i];
                    enemy.x += enemy.vx;
                    
                    if (enemy.x <= 0 || enemy.x >= self.width - enemy.width) {
                        enemy.vx *= -1;
                    }
                    
                    if (Date.now() - enemy.lastShot > 1000 && Math.random() > 0.7) {
                        self.enemyBullets.push({
                            x: enemy.x + enemy.width / 2 - 6,
                            y: enemy.y + enemy.height + 5,
                            width: 12,
                            height: 35,
                            speed: 8,
                            img: images.bullet
                        });
                        enemy.lastShot = Date.now();
                    }
                }
                
                // Астероиды
                for (var i = self.asteroids.length - 1; i >= 0; i--) {
                    var asteroid = self.asteroids[i];
                    asteroid.y += asteroid.speed;
                    
                    if (self.checkCollision(self.player, asteroid) && !self.hasShield) {
                        self.health -= 20;
                        self.updateHealthBar();
                        if (self.health <= 0) self.end();
                    }
                    
                    if (asteroid.y > self.height || self.checkCollision(self.player, asteroid)) {
                        self.asteroids.splice(i, 1);
                    }
                }
                
                // Монеты
                for (var i = self.coinItems.length - 1; i >= 0; i--) {
                    var coin = self.coinItems[i];
                    coin.y += coin.speed;
                    
                    if (self.checkCollision(self.player, coin)) {
                        self.coins++;
                        document.getElementById('coins').textContent = self.coins;
                        self.stats.coins = self.coins;
                        
                        if (self.coins > 0 && self.coins % 5 === 0 && !self.hasShield) {
                            self.activateShield();
                        }
                        
                        self.coinItems.splice(i, 1);
                    } else if (coin.y > self.height) {
                        self.coinItems.splice(i, 1);
                    }
                }
                
                // Ящики
                for (var i = self.boxes.length - 1; i >= 0; i--) {
                    var box = self.boxes[i];
                    box.y += box.speed;
                    
                    if (self.checkCollision(self.player, box)) {
                        self.ammo += 10;
                        document.getElementById('ammo').textContent = self.ammo;
                        self.boxes.splice(i, 1);
                    } else if (box.y > self.height) {
                        self.boxes.splice(i, 1);
                    }
                }
                
                // Пули игрока
                for (var i = self.playerBullets.length - 1; i >= 0; i--) {
                    var bullet = self.playerBullets[i];
                    bullet.y += bullet.speed;
                    var hit = false;
                    
                    for (var j = self.enemies.length - 1; j >= 0; j--) {
                        if (self.checkCollision(bullet, self.enemies[j])) {
                            self.enemies[j].health -= 10;
                            if (self.enemies[j].health <= 0) {
                                self.enemies.splice(j, 1);
                                self.stats.enemies++;
                                self.lastEnemyTime = Date.now();
                            }
                            hit = true;
                            break;
                        }
                    }
                    
                    if (hit || bullet.y < -30) {
                        self.playerBullets.splice(i, 1);
                    }
                }
                
                // Пули врагов
                for (var i = self.enemyBullets.length - 1; i >= 0; i--) {
                    var bullet = self.enemyBullets[i];
                    bullet.y += bullet.speed;
                    
                    if (self.checkCollision(bullet, self.player) && !self.hasShield) {
                        self.health -= 10;
                        self.updateHealthBar();
                        if (self.health <= 0) self.end();
                        self.enemyBullets.splice(i, 1);
                    } else if (bullet.y > self.height) {
                        self.enemyBullets.splice(i, 1);
                    }
                }
                
                // Столкновения с врагами
                for (var i = self.enemies.length - 1; i >= 0; i--) {
                    if (self.checkCollision(self.player, self.enemies[i]) && !self.hasShield) {
                        self.enemies[i].health -= 20;
                        if (self.enemies[i].health <= 0) {
                            self.enemies.splice(i, 1);
                            self.stats.enemies++;
                            self.lastEnemyTime = Date.now();
                        } else {
                            self.health -= 10;
                            self.updateHealthBar();
                            if (self.health <= 0) self.end();
                        }
                    }
                }
            },
            
            // ============ ЗДОРОВЬЕ ============
            updateHealthBar: function() {
                var self = game;
                var bar = document.getElementById('health');
                bar.style.width = self.health + '%';
                
                if (self.health < 30) {
                    bar.style.background = '#ff3333';
                } else if (self.health < 60) {
                    bar.style.background = '#ffcc00';
                } else {
                    bar.style.background = '#44cc44';
                }
            },
            
            // ============ ОТРИСОВКА ============
            render: function() {
                var self = game;
                if (!self.running) return;
                
                // Удаляем старые объекты
                while (self.gameArea.children.length > 3) {
                    self.gameArea.removeChild(self.gameArea.lastChild);
                }
                
                // Рисуем игрока
                self.draw(self.player, 'player');
                
                // Рисуем всё остальное
                for (var i = 0; i < self.enemies.length; i++) {
                    self.draw(self.enemies[i], 'enemy');
                }
                
                for (var i = 0; i < self.asteroids.length; i++) {
                    self.draw(self.asteroids[i], 'asteroid');
                }
                
                for (var i = 0; i < self.coinItems.length; i++) {
                    var el = self.draw(self.coinItems[i], 'coin');
                    el.style.width = '50px';
                    el.style.height = '50px';
                }
                
                for (var i = 0; i < self.boxes.length; i++) {
                    var el = self.draw(self.boxes[i], 'box');
                    el.style.width = '50px';
                    el.style.height = '50px';
                }
                
                for (var i = 0; i < self.playerBullets.length; i++) {
                    self.draw(self.playerBullets[i], 'bullet');
                }
                
                for (var i = 0; i < self.enemyBullets.length; i++) {
                    var el = self.draw(self.enemyBullets[i], 'eb');
                    el.style.transform = 'scaleY(-1)';
                }
            },
            
            // ============ ОТРИСОВКА ОДНОГО ОБЪЕКТА ============
            draw: function(object, className) {
                var element = document.createElement('div');
                element.className = 'obj ' + className;
                
                if (object.img && object.img.complete) {
                    element.style.backgroundImage = 'url(' + object.img.src + ')';
                }
                
                element.style.left = object.x + 'px';
                element.style.top = object.y + 'px';
                element.style.width = object.width + 'px';
                element.style.height = object.height + 'px';
                
                game.gameArea.appendChild(element);
                return element;
            },
            
            // ============ КОНЕЦ ИГРЫ ============
            end: function() {
                var self = game;
                self.running = false;
                self.stats.time = self.time;
                
                var minutes = Math.floor(self.stats.time / 60);
                var seconds = self.stats.time % 60;
                if (minutes < 10) minutes = '0' + minutes;
                if (seconds < 10) seconds = '0' + seconds;
                
                document.getElementById('final-time').textContent = minutes + ':' + seconds;
                document.getElementById('final-coins').textContent = self.stats.coins;
                document.getElementById('final-enemies').textContent = self.stats.enemies;
                
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('stats-screen').style.display = 'flex';
            },
            
            // ============ ИГРОВОЙ ЦИКЛ ============
            loop: function() {
                var self = game;
                self.update();
                self.render();
                requestAnimationFrame(function() {
                    self.loop();
                });
            }
        };
        
        // ============ ЗАПУСК ============
        window.onload = function() {
            game.init();
        };
    </script>
</body>
</html>