<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Космическая игра</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#0a0a2a;color:white;font:24px Arial;text-align:center}
        .screen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10}
        #game-screen,#stats-screen{display:none}
        button{padding:15px 40px;background:#4a86e8;color:white;border:none;border-radius:10px;cursor:pointer;margin:20px}
        button:hover{background:#5a96f8;transform:scale(1.05);transition:all .2s}
        button:disabled{background:#7f9fc9;cursor:not-allowed}
        #game{width:800px;height:600px;position:relative;background:#000;margin:0 auto;overflow:hidden;border:3px solid #4a86e8}
        .hud{position:absolute;top:15px;left:15px;text-align:left;background:rgba(0,0,0,.7);padding:10px;border-radius:5px}
        .health-bar{position:absolute;top:15px;right:15px;width:200px;height:25px;background:#333;border:2px solid white}
        .health-fill{height:100%;background:#4caf50;width:100%}
        .obj{position:absolute;background-size:contain;background-repeat:no-repeat}
        h1{font-size:48px;margin-bottom:30px;color:#4a86e8;text-shadow:0 0 10px #4a86e8}
        .stats-item{font-size:28px;margin:15px 0;color:#f1c40f}
        .stats-label{color:#4a86e8;font-size:22px}
        input{padding:15px;font:24px Arial;border:3px solid #4a86e8;border-radius:10px;margin:20px;text-align:center}
    </style>
</head>
<body>
    <div id="start-screen" class="screen">
        <h1>КОСМИЧЕСКАЯ ИГРА</h1>
        <input type="text" id="name" placeholder="Ваше имя" maxlength="15">
        <button id="start-btn" disabled>НАЧАТЬ</button>
        <p style="font-size:18px;margin-top:30px">Управление: WASD или стрелки</p>
    </div>

    <div id="game-screen">
        <div id="game">
            <div class="hud">
                <div>Время: <span id="timer">00:00</span></div>
                <div>Монеты: <span id="coins">0</span></div>
                <div>Патроны: <span id="ammo">30</span></div>
            </div>
            <div class="health-bar"><div class="health-fill" id="health"></div></div>
        </div>
    </div>

    <div id="stats-screen" class="screen">
        <h1>ИГРА ОКОНЧЕНА</h1>
        <div class="stats-item">Время: <span class="stats-label" id="time">00:00</span></div>
        <div class="stats-item">Монет: <span class="stats-label" id="stat-coins">0</span></div>
        <div class="stats-item">Врагов: <span class="stats-label" id="stat-enemies">0</span></div>
        <button id="restart-btn">НОВАЯ ИГРА</button>
        <button id="menu-btn">МЕНЮ</button>
    </div>

    <script>
        // Загрузка картинок
        const img = {};
        ['space','rocket','asteroid','box','bullet','enemy','money'].forEach(n=>{
            img[n]=new Image(); img[n].src='img/'+n+'.png'
        });

        class Game {
            constructor() {
                this.g = document.getElementById('game');
                this.w = 800; this.h = 600;
                this.t = 0; this.c = 0; this.a = 30;
                this.hp = 100; this.shield = false; this.run = false;
                this.keys = {};
                
                this.p = {x:this.w/2-30, y:this.h-80, w:60, h:80, vx:0, vy:0, max:7, img:img.rocket};
                
                this.enemies = []; this.asteroids = [];
                this.coins = []; this.boxes = [];
                this.pBullets = []; this.eBullets = [];
                
                this.stats = {time:0, coins:0, enemies:0};
                this.lastEnemy = 0; this.lastShot = 0;
                
                this.init();
            }
            
            init() {
                // Поле имени
                document.getElementById('name').oninput = e => 
                    document.getElementById('start-btn').disabled = e.target.value.trim() === '';
                
                // Кнопки
                document.getElementById('start-btn').onclick = () => this.start();
                document.getElementById('restart-btn').onclick = () => this.start();
                document.getElementById('menu-btn').onclick = () => {
                    document.getElementById('stats-screen').style.display = 'none';
                    document.getElementById('start-screen').style.display = 'flex';
                };
                
                // Клавиатура
                document.onkeydown = e => this.keys[e.key.toLowerCase()] = true;
                document.onkeyup = e => this.keys[e.key.toLowerCase()] = false;
                
                // Спавн объектов
                setInterval(() => { if(this.run) this.addAsteroid() }, 2000);
                setInterval(() => { if(this.run) this.addCoin() }, 2000);
                setInterval(() => { if(this.run) this.addBox() }, 10000);
                setInterval(() => { if(this.run) this.addEnemy() }, 10000);
                setInterval(() => { if(this.run) { this.t++; this.updateTime() } }, 1000);
                setInterval(() => { if(this.run && this.keys[' '] && this.a>0 && Date.now()-this.lastShot>200) this.shoot() }, 50);
                
                this.loop();
            }
            
            start() {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('stats-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                
                this.t = 0; this.c = 0; this.a = 30;
                this.hp = 100; this.shield = false; this.run = true;
                
                this.p.x = this.w/2-30; this.p.y = this.h-80;
                this.p.img = img.rocket;
                
                this.enemies = []; this.asteroids = [];
                this.coins = []; this.boxes = [];
                this.pBullets = []; this.eBullets = [];
                
                this.stats = {time:0, coins:0, enemies:0};
                this.lastEnemy = Date.now(); this.lastShot = 0;
                
                this.updateHP();
                document.getElementById('timer').textContent = '00:00';
                document.getElementById('coins').textContent = '0';
                document.getElementById('ammo').textContent = '30';
            }
            
            updateTime() {
                let m = Math.floor(this.t/60).toString().padStart(2,'0');
                let s = (this.t%60).toString().padStart(2,'0');
                document.getElementById('timer').textContent = m+':'+s;
            }
            
            addAsteroid() {
                this.asteroids.push({
                    x: Math.random()*(this.w-60),
                    y: -60, w: 60, h: 60,
                    s: 3+Math.random()*2,
                    img: img.asteroid
                });
            }
            
            addCoin() {
                this.coins.push({
                    x: Math.random()*(this.w-50),
                    y: -60, w: 50, h: 50,
                    s: 2+Math.random(),
                    img: img.money
                });
            }
            
            addBox() {
                this.boxes.push({
                    x: Math.random()*(this.w-50),
                    y: -60, w: 50, h: 50,
                    s: 2+Math.random(),
                    img: img.box
                });
            }
            
            addEnemy() {
                if(Date.now() - this.lastEnemy < 10000) return;
                this.enemies.push({
                    x: Math.random()*(this.w-100),
                    y: 50, w: 100, h: 70,
                    vx: (Math.random()>0.5?1:-1)*(2+Math.random()*2),
                    hp: [10,20,30][Math.floor(Math.random()*3)],
                    ls: Date.now(),
                    img: img.enemy
                });
                this.lastEnemy = Date.now();
            }
            
            shoot() {
                this.a--; this.lastShot = Date.now();
                document.getElementById('ammo').textContent = this.a;
                this.pBullets.push({
                    x: this.p.x+26, y: this.p.y-30,
                    w: 12, h: 35, s: -12,
                    img: img.bullet
                });
            }
            
            hit(a,b) {
                return a.x < b.x+b.w-10 && a.x+a.w-10 > b.x &&
                       a.y < b.y+b.h-10 && a.y+a.h-10 > b.y;
            }
            
            shieldOn() {
                this.shield = true; this.p.img = img.bullet;
                setTimeout(() => { this.shield = false; this.p.img = img.rocket }, 5000);
            }
            
            update() {
                if(!this.run) return;
                
                // Движение игрока
                this.p.vx = 0; this.p.vy = 0;
                if(this.keys['a']||this.keys['arrowleft']) this.p.vx = -this.p.max;
                if(this.keys['d']||this.keys['arrowright']) this.p.vx = this.p.max;
                if(this.keys['w']||this.keys['arrowup']) this.p.vy = -this.p.max;
                if(this.keys['s']||this.keys['arrowdown']) this.p.vy = this.p.max;
                
                this.p.x += this.p.vx; this.p.y += this.p.vy;
                this.p.x = Math.max(0, Math.min(this.p.x, this.w-this.p.w));
                this.p.y = Math.max(0, Math.min(this.p.y, this.h-this.p.h));
                
                // Враги
                for(let i=this.enemies.length-1; i>=0; i--) {
                    let e = this.enemies[i];
                    e.x += e.vx;
                    if(e.x<=0 || e.x>=this.w-e.w) e.vx *= -1;
                    if(Date.now()-e.ls>1000 && Math.random()>0.7) {
                        this.eBullets.push({x:e.x+e.w/2-6, y:e.y+e.h+5, w:12, h:35, s:8, img:img.bullet});
                        e.ls = Date.now();
                    }
                }
                
                // Астероиды
                for(let i=this.asteroids.length-1; i>=0; i--) {
                    let a = this.asteroids[i]; a.y += a.s;
                    for(let j=this.pBullets.length-1; j>=0; j--) if(this.hit(this.pBullets[j], a)) { this.pBullets.splice(j,1); break; }
                    for(let j=this.eBullets.length-1; j>=0; j--) if(this.hit(this.eBullets[j], a)) { this.eBullets.splice(j,1); break; }
                    if(this.hit(this.p, a) && !this.shield) { this.hp -= 20; this.updateHP(); if(this.hp<=0) this.end(); }
                    if(a.y>this.h || this.hit(this.p, a)) this.asteroids.splice(i,1);
                }
                
                // Монеты
                for(let i=this.coins.length-1; i>=0; i--) {
                    let c = this.coins[i]; c.y += c.s;
                    if(this.hit(this.p, c)) {
                        this.c++; document.getElementById('coins').textContent = this.c; this.stats.coins = this.c;
                        if(this.c >= 5) { this.shieldOn(); this.c = 0; document.getElementById('coins').textContent = '0'; }
                        this.coins.splice(i,1);
                    } else if(c.y>this.h) this.coins.splice(i,1);
                }
                
                // Коробки
                for(let i=this.boxes.length-1; i>=0; i--) {
                    let b = this.boxes[i]; b.y += b.s;
                    if(this.hit(this.p, b)) { this.a += 10; document.getElementById('ammo').textContent = this.a; this.boxes.splice(i,1); }
                    else if(b.y>this.h) this.boxes.splice(i,1);
                }
                
                // Пули игрока
                for(let i=this.pBullets.length-1; i>=0; i--) {
                    let b = this.pBullets[i]; b.y += b.s; let h = false;
                    for(let j=this.enemies.length-1; j>=0; j--) {
                        if(this.hit(b, this.enemies[j])) {
                            this.enemies[j].hp -= 10;
                            if(this.enemies[j].hp <= 0) { this.enemies.splice(j,1); this.stats.enemies++; this.lastEnemy = Date.now(); }
                            h = true; break;
                        }
                    }
                    if(h || b.y<-30) this.pBullets.splice(i,1);
                }
                
                // Пули врагов
                for(let i=this.eBullets.length-1; i>=0; i--) {
                    let b = this.eBullets[i]; b.y += b.s;
                    if(this.hit(b, this.p) && !this.shield) { this.hp -= 10; this.updateHP(); if(this.hp<=0) this.end(); this.eBullets.splice(i,1); }
                    else if(b.y>this.h) this.eBullets.splice(i,1);
                }
                
                // Столкновение с врагами
                for(let i=this.enemies.length-1; i>=0; i--) {
                    if(this.hit(this.p, this.enemies[i]) && !this.shield) {
                        this.enemies[i].hp -= 20;
                        if(this.enemies[i].hp <= 0) { this.enemies.splice(i,1); this.stats.enemies++; this.lastEnemy = Date.now(); }
                        else { this.hp -= 10; this.updateHP(); if(this.hp<=0) this.end(); }
                    }
                }
            }
            
            updateHP() {
                let bar = document.getElementById('health');
                bar.style.width = this.hp + '%';
                bar.style.background = this.hp<30 ? '#e74c3c' : this.hp<60 ? '#f39c12' : '#4caf50';
            }
            
            render() {
                if(!this.run) return;
                while(this.g.children.length > 2) this.g.removeChild(this.g.lastChild);
                if(img.space.complete) {
                    this.g.style.backgroundImage = 'url('+img.space.src+')';
                    this.g.style.backgroundRepeat = 'repeat';
                }
                this.draw(this.p, 'player');
                this.enemies.forEach(e => this.draw(e, 'enemy'));
                this.asteroids.forEach(a => this.draw(a, 'asteroid'));
                this.coins.forEach(c => { let el=this.draw(c,'coin'); el.style.width='50px'; el.style.height='50px'; });
                this.boxes.forEach(b => { let el=this.draw(b,'box'); el.style.width='50px'; el.style.height='50px'; });
                this.pBullets.forEach(b => this.draw(b, 'bullet'));
                this.eBullets.forEach(b => { let el=this.draw(b,'eb'); el.style.transform='scaleY(-1)'; });
            }
            
            draw(o, cls) {
                let el = document.createElement('div');
                el.className = 'obj '+cls;
                if(o.img && o.img.complete) el.style.backgroundImage = 'url('+o.img.src+')';
                el.style.left = o.x+'px'; el.style.top = o.y+'px';
                el.style.width = o.w+'px'; el.style.height = o.h+'px';
                this.g.appendChild(el);
                return el;
            }
            
            end() {
                this.run = false; this.stats.time = this.t;
                let m = Math.floor(this.stats.time/60).toString().padStart(2,'0');
                let s = (this.stats.time%60).toString().padStart(2,'0');
                document.getElementById('time').textContent = m+':'+s;
                document.getElementById('stat-coins').textContent = this.stats.coins;
                document.getElementById('stat-enemies').textContent = this.stats.enemies;
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('stats-screen').style.display = 'flex';
            }
            
            loop() {
                this.update(); this.render();
                requestAnimationFrame(() => this.loop());
            }
        }
        
        new Game();
    </script>
</body>
</html>